<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Drupal Commerce 2.x - All the cards for an e-commerce business - Fabien Clément</title>

    <link rel="shortcut icon" href="lib/image/favicon.ico" />
		<meta name="description" content="Drupal Commerce 2.x - All the cards for an e-commerce business.">
		<meta name="author" content="Fabien Clément">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">
		<link rel="stylesheet" href="css/theme/dclannion2017.css">
		<link rel="stylesheet" href="css/theme/personal.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
        <footer>
            <div class="branding--logo">
                <a class="logo__image__lequipetech" href="http://www.lequipe.tech">L'équipe.tech</a>
                <span class="logo__image"><img src="lib/image/logo-seul.png" alt="DrupalCamp Lannion 2017" height="55px"></span>
                <p class="logo__site-name">#dclannion</p>
            </div>
            <div class="session--info">
                <p class="session__title">Drupal Commerce 2.x<span class="seperator">&nbsp;/&nbsp;</span></p>
                <p class="session__presenter">Fabien Clément @GozOo</p>
            </div>
        </footer>
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section class="dclannion2017-intro" data-background="lib/image/background.jpg">
					<h1>Drupal Commerce 2.x - All the cards for an e-commerce business.</h1>
					<h2>Fabien Clément - @GozOo</h2>
                    <p class="function">
                        <small>CTO <a href="https://twitter.com/lequipetech">@lequipetech</a></small>
                    </p>
				</section>

                <section>
                    <section>
                        <h2>Drupal &amp; Commerce</h2>
                    </section>
                    <section>
                        <h2>Once upon a time...</h2>
                        <p>
                            2007: Drupal 5 then 6 and Ubercart.
                        </p>
                        <p>
                            2010: Drupal 7, Completly rewriten, creation of Commerce module mainly by Commerce Guys, company created for this purpose.
                        </p>
                    </section>
                    <section>
                        <h2>Drupal 7 &amp; commerce</h2>
                        <p>
                            Commerce, first to make maximum use of Drupal 7's new features (entities, bundles etc) and to contribute to improve Drupal core.
                        </p>
                    </section>
                    <section>
                        <h2>Today</h2>
                        <p>
                            Commerce 2.x, rewriten for Drupal 8.
                        </p>
                    </section>
                    <section>
                        <h2>Drupal 8 &amp; Commerce 2.x</h2>
                        <p>
                            Still a reference to follow the best practices of development.
                        </p>
                        <p>
                            Still a major contributor to Drupal 8 core.
                        </p>
                    </section>
                </section>

                <!-- Example of nested vertical slides -->
                <section>
                    <section>
                        <h2>Under the hood of Commerce 2.x</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>PHP Libraries</h2>
                    </section>
                    <section>
                        <h2>Creation of PHP librairies usable and used by the PHP community</h2>
                        <ul>
                            <li class="fragment"><strong style="color: #fcc500;">commerceguys/intl</strong>: A PHP 5.4+ internationalization library, powered by CLDR data. Deal with NumberFormatter, inspired by intl, Currencies, Countries, Languages.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Creation of PHP librairies usable and used by the PHP community</h2>
                        <ul>
                            <li><strong style="color: #fcc500;">commerceguys/addressing</strong>: A PHP 5.5+ addressing library, powered by Google's dataset. Stores and manipulates postal addresses, meant to identify a precise recipient location for shipping or billing purposes..</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Entities (Ab)use</h2>
                        <div class="box fragment" style="width: 40%;display: inline-block; vertical-align: top;margin: 1em;">
                            <div class="box-content" style="font-size: 0.8em;">
                                <ul>
                                    <li>Store</li>
                                    <li>Product</li>
                                    <li>Product variation</li>
                                    <li>Order</li>
                                    <li>Order Item</li>
                                </ul>
                            </div>
                        </div>
                        <div class="box fragment" style="width: 40%;display: inline-block; vertical-align: top;margin: 1em;">
                            <div class="box-content" style="font-size: 0.8em;">
                                <ul>
                                    <li>Workflow</li>
                                    <li>Checkout</li>
                                    <li>Payment</li>
                                    <li>Price</li>
                                    <li>Etc.</li>
                                </ul>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h2>But also Plugins</h2>
                        <div class="box fragment" style="width: 40%;display: inline-block; vertical-align: top;margin: 1em;">
                            <div class="box-content" style="font-size: 0.8em;">
                                <ul>
                                    <li>Promotion</li>
                                    <li>Coupon</li>
                                    <li>CheckoutPane</li>
                                    <li>PaymentGateway</li>
                                </ul>
                            </div>
                        </div>
                        <div class="box fragment" style="width: 40%;display: inline-block; vertical-align: top;margin: 1em;">
                            <div class="box-content" style="font-size: 0.8em;">
                                <ul>
                                    <li>States</li>
                                    <li>TaxType</li>
                                    <li>Etc.</li>
                                </ul>
                            </div>
                        </div>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Commerce Out of the Box</h2>
                        <p>... NO</p>
                        <ul>
                            <li>Mandatory configuration to start a simple business (e. g. selling t-shirts)</li>
                            <li>Create a store</li>
                            <li>Add a currency</li>
                            <li>Define product types</li>
                            <li>Configure product displays, listing, add to cart</li>
                            <li>Checkout</li>
                            <li>Payment</li>
                            <li>No theme by default</li>
                            <li>etc.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Commerce for business</h2>
                        <p>Who say fit to business, say custom development.</p>
                        <p>Favourite land of Commerce 2.x.</p>
                        <p>Almost everything can be extended, overrided, adding plugins, reacting to events, processors etc.</p>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Case studies</h2>
                    </section>
                    <section>
                        <h2>Differents displays for a form</h2>
                        <p class="fragment" style="color: #fcc500;">
                            <i>Example: A specific display for companies, another one for individuals.</i>
                        </p>
                        <p class="fragment">
                            Drupal 8 implements <strong>form view display</strong>.
                        </p>
                        <p class="fragment">
                            Differents displays of form of an entity depending of conditions:
                            <ul>
                                <li class="fragment">Display differents widgets.</li>
                                <li class="fragment">Display more or less fields.</li>
                            </ul>
                        </p>
                    </section>
                    <section>
                        <h2>Differents checkouts</h2>
                        <ul style="color: #fcc500;">
                            <li class="fragment">A checkout to download e-book files.</li>
                            <li class="fragment">A Checkout to buy a book.</li>
                        </ul>
                        <p class="fragment" style="color: #fcc500;">For each of them, differents flows, panes and process.</p>
                    </section>
                    <section>
                        <h2>Differents checkouts</h2>
                        <p>For that:</p>
                        <ul>
                            <li style="color: #fcc500;">Checkout: entity </li>
                            <li class="fragment">But also:
                                <ul>
                                    <li class="fragment">Plugins to deal with panes.</li>
                                    <li class="fragment">Checkout flows.</li>
                                    <li class="fragment">Resolver to override the rules of the checkout flow.</li>
                                </ul>
                            </li>
                        </ul>
                    </section>
                    <section>
                        <h2>Several stores</h2>
                        <p class="fragment" style="color: #fcc500;"><i>Example: You need to have a store by country.</i></p>
                        <p class="fragment" style="color: #fcc500;">Store: entity </p>
                        <ul>
                            <li class="fragment">A store has a currency by default.</li>
                            <li class="fragment">Products are assigned to at least one store.</li>
                            <li class="fragment">Context take care of store to change checkout, prices etc.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Integrated payment configuration</h2>
                        <p class="fragment" style="color: #fcc500;">Payment: plugin</p>
                        <p class="fragment" style="color: #fcc500;">PaymentMethod: plugin</p>
                        <ul>
                            <li class="fragment">Standardization of payment configuration:
                                <ul>
                                    <li class="fragment">Credentials by environnement: development, validation, production.</li>
                                    <li class="fragment">Methods and routes for the payment service feedbacks.</li>
                                </ul>
                            </li>
                        </ul>
                    </section>
                    <section>
                        <h2>Integrated payment configuration</h2>
                        <ul>
                            <li>Paiement Onsite.</li>
                            <li class="fragment">Paiement Offsite.</li>
                            <li class="fragment">Payment methods integrated to commerce core and overridable by plugins.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Price Resolver</h2>
                        <p style="color: #fcc500;" class="fragment">Ex: Booking a room, price can be calculated dynamically depending of period, number of people etc.</p>
                        <p class="fragment">During the display of the formatted calculated price, you can add your own calculation rules to the base price.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
services:
 booking.room_price_resolver:
   class: Drupal\booking\Resolver\RoomPriceResolver
   tags:
     - { name: commerce_price.price_resolver, priority: 0 }
                        </code></pre>
                    </section>
                    <section>
                        <h2>Adjustments &amp; OrderProcessor</h2>
                        <p>It's possible to add adjustments to a total price of an order or of order items.</p>
                        <p style="color: #fcc500;" class="fragment">Promotions (previously discount) are an example of adjustment by default. Adjustments allow to add configurable plugins by the user.</p>
                        <p style="color: #fcc500;" class="fragment">Taxs are another example of adjustment provided by Commerce core.</p>
                    </section>
                    <section>
                        <h2>Adjustments &amp; OrderProcessor</h2>
                        <p style="color: #fcc500;" class="fragment">Promotion module add a service at order processor which then allow to select and apply required promotions and adjustments.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
services:
 commerce_promotion.promotion_order_processor:
   class: Drupal\commerce_promotion\PromotionOrderProcessor
   arguments: ['@entity_type.manager']
   tags:
     - { name: commerce_order.order_processor, priority: 50 }
                        </code></pre>
                    </section>
                    <section>
                        <h2>Adjustments &amp; OrderProcessor</h2>
                        <p style="color: #fcc500;" class="fragment">Example to apply a promotion of n%.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
$order->addAdjustment(new Adjustment([
 'type' => 'promotion',
 'label' => t('Discount'),
 'amount' => $adjustment_amount->multiply('-1'),
 'percentage' => $this->getPercentage(),
 'source_id' => $promotion->id(),
]));
                        </code></pre>
                    </section>
                    <section>
                        <h2>Promotions</h2>
                        <p class="fragment">Promotions (previously discount) and coupons are now parts of commerce and thoses plugins are easily extendable.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
/**
 * Provides the product condition for order items.
 *
 * @CommerceCondition(
 *   id = "order_item_product",
 *   label = @Translation("Product"),
 *   display_label = @Translation("Limit by product"),
 *   category = @Translation("Product"),
 *   entity_type = "commerce_order_item",
 * )
 */
class OrderItemProduct extends ConditionBase implements ContainerFactoryPluginInterface {}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Promotions</h2>
                        <pre class="fragment"><code style="word-wrap: break-word;">

/**
 * Provides the percentage off offer for orders.
 *
 * @CommercePromotionOffer(
 *   id = "order_external_off",
 *   label = @Translation("Fixed amount off the order total depending of external service"),
 *   entity_type = "commerce_order",
 * )
 */
class OrderExternalOff extends FixedAmountOffBase {
 /**
  * {@inheritdoc}
  */
 public function apply(EntityInterface $entity, PromotionInterface $promotion) {
   $this->assertEntity($entity);
   /** @var \Drupal\commerce_order\Entity\OrderInterface $order */
   $order = $entity;
   $total_price = $order->getTotalPrice();
   $adjustment_amount = $this->getAmount();
   $external_service = \Drupal::service('order.promotion.external.service');
 
   $order->addAdjustment(new Adjustment([
     'type' => 'promotion',
     // @todo Change to label from UI when added in #2770731.
     'label' => t('Discount'),
     'amount' => $external_service->getPromotionAmount($entity),
     'source_id' => $promotion->id(),
   ]));
  }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Migration</h2>
                        <p>No more needs of extra modules to deal with migrations in Commerce 2.x.</p>
                        <pre class="fragment"><code style="word-wrap: break-word;">
id: import_products
label: 'Import products to Commerce'
source:
  ...
process:
  type:
    plugin: default_value
    default_value: default
  title: title_from_import
  ...
destination:
  plugin: 'entity:commerce_product'
                        </code></pre>
                    </section>
                    <section>
                        <h2>Synchronization of external services</h2>
                        <ul>
                            <li class="fragment">Entities and plugins can be created/updated by migration.</li>
                            <li class="fragment">Events (symfony EventSubscribers) allow to react to call own services at the good time.</li>
                            <li class="fragment">REST module provided by core allow a quick implementation.</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Ahead of the core</h2>
                        <ul>
                            <li class="fragment">Use events instead of hooks (Bye Bye hooks!).</li>
                            <li class="fragment">Unit tests and functionals with PHPUnit (+ javascript with mink).</li>
                            <li class="fragment">Use composer since the beginning.</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>And of course</h2>
                        <p>A team available and reactive.</p>
                        <p>Constant adoption with 2k uses since its release in September.</p>
                    </section>
                </section>

                <section style="text-align: left;">
                    <h1>Any questions ?</h1>
                    <p>
                        <a href="https://gozoo.github.io/prez-drupal-commerce-2-dclannion">Get this online on https://gozoo.github.io/prez-drupal-commerce-2-dclannion</a> <br>
                    </p>
                </section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
